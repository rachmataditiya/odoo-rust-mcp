services:
  odoo-mcp:
    build:
      context: ./rust-mcp
      dockerfile: Dockerfile
    ports:
      - "8787:8787"
    # Mount JSON configs so they always exist and can be edited without rebuilding.
    # Use :rw so the server can rewrite defaults if needed.
    volumes:
      - ./rust-mcp/tools.json:/config/tools.json:rw
      - ./rust-mcp/prompts.json:/config/prompts.json:rw
      - ./rust-mcp/server.json:/config/server.json:rw
    env_file:
      - .env
    environment:
      # IMPORTANT:
      # - If Odoo runs on your HOST at localhost:8069, containers must use host.docker.internal:8069 (Mac/Windows).
      # - On Linux, we add extra_hosts below so host.docker.internal resolves to the host gateway.
      ODOO_URL: "http://host.docker.internal:8069"
      ODOO_DB: "v19_pos"
      ODOO_API_KEY: "${ODOO_API_KEY}"
      # MCP JSON config paths (inside container)
      MCP_TOOLS_JSON: "/config/tools.json"
      MCP_PROMPTS_JSON: "/config/prompts.json"
      MCP_SERVER_JSON: "/config/server.json"
      # Optional:
      # ODOO_ENABLE_CLEANUP_TOOLS: "true"
      # ODOO_TIMEOUT_MS: "30000"
      # ODOO_MAX_RETRIES: "2"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    # Default CMD is HTTP (`/mcp`). To force other transports, uncomment:
    # command: ["rust-mcp", "--transport", "ws", "--listen", "0.0.0.0:8787"]

